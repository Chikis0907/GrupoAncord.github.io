<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actualizar Precios</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .current-price {
      font-weight: bold;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body class="bg-light">
  
  <div class="container py-4">
    <div class="text-center">
      <img src="../img/groAncor.png" alt="Grupo Ancor" style="max-height: 80px; margin-top: 10px;">
    </div>

    <h2 class="text-center text-primary mb-4">Actualizar Precios</h2>
    
   
    <!-- Dentro del <body>, reemplaza lo que está entre los divs del form: -->

<form id="formPrecios" class="border p-4 rounded bg-white">
  <div class="mb-3">
    
    <label for="familia">Selecciona Familia de Acero:</label>
    <select class="form-select" id="familia" name="familia" required>
      <option value="">-- Selecciona --</option>
      <option value="frio">Trabajo en frío</option>
      <option value="moldes">Moldes plásticos</option>
      <option value="caliente">Trabajo en caliente</option>
      <option value="velocidad">Alta velocidad</option>
      <option value="inoxidable">Inoxidables</option>
      <option value="mecanica">Construcción mecánica</option>
    </select>
  </div>

   <div class="row mb-4 justify-content-center">
      <div class="col-md-5 text-center p-3">
        Precio Mínimo Actual
        <div id="precioMin" class="current-price bg-success bg-opacity-10 text-success" style="visibility:hidden">$0.00</div>
      </div>
      <div class="col-md-5 text-center p-3">
        Precio Máximo Actual
        <div id="precioMax" class="current-price bg-danger bg-opacity-10 text-danger" style="visibility:hidden">$0.00</div>      </div>
    </div>
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="precio1" class="form-label">Nuevo precio mínimo:</label>
      <input type="number" step="0.01" min="0" class="form-control" id="precio1" name="precio1" placeholder="Ej. 12.00">
    </div>
    <div class="col-md-6">
      <label for="precio2" class="form-label">Nuevo precio máximo:</label>
      <input type="number" step="0.01" min="0" class="form-control" id="precio2" name="precio2" placeholder="Ej. 51.00">
    </div>
  </div>

  <div class="text-center mt-3">
    <button type="submit" class="btn btn-primary px-4">Actualizar Precios</button>
    <a href="tratamientos_termicos.html" class="btn btn-secondary ms-2">Regresar</a>
  </div>
</form>

  

  <!-- Sustituye el <script> actual completo por este: -->
<script>
  const familias = [
    "frio", "moldes", "caliente", "velocidad", "inoxidable", "mecanica"
  ];

  const preciosPorFamilia = {};

  // Al cargar: obtener todos los precios
  fetch('obtener_precios.php')
    .then(res => res.json())
    .then(data => {
      preciosPorFamilia.frio = { precioMin: data.frioMin, precioMax: data.frioMax };
      preciosPorFamilia.moldes = { precioMin: data.moldesMin, precioMax: data.moldesMax };
      preciosPorFamilia.caliente = { precioMin: data.calienteMin, precioMax: data.calienteMax };
      preciosPorFamilia.velocidad = { precioMin: data.velocidadMin, precioMax: data.velocidadMax };
      preciosPorFamilia.inoxidable = { precioMin: data.inoxidableMin, precioMax: data.inoxidableMax };
      preciosPorFamilia.mecanica = { precioMin: data.mecanicaMin, precioMax: data.mecanicaMax };
    });

  // Cambiar precios al seleccionar familia
  document.getElementById("familia").addEventListener("change", function () {
    const fam = this.value;
    if (preciosPorFamilia[fam]) {
      document.getElementById("precioMin").style.visibility = "visible";
      document.getElementById("precioMax").style.visibility = "visible";
      document.getElementById("precioMin").textContent = '$' + parseFloat(preciosPorFamilia[fam].precioMin).toFixed(2);
      document.getElementById("precioMax").textContent = '$' + parseFloat(preciosPorFamilia[fam].precioMax).toFixed(2);
    }
  });

  // Enviar formulario
  document.getElementById('formPrecios').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch('guardar_precios.php', {
      method: 'POST',
      body: formData
    })
    .then(res => res.text())
    .then(res => {
      alert(res);
      window.location.href = 'tratamientos_termicos.html';
    });
  });
</script>

</body>
</html>
